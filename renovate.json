{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["config:recommended", ":gitSignOff"],
  "baseBranchPatterns": ["main"],
  "semanticCommits": "enabled",
  "prCreation": "immediate",
  "automergeType": "pr",
  "platformAutomerge": true,
  "rebaseWhen": "behind-base-branch",
  "ignoreTests": true,
  "pyenv": {
    "enabled": false
  },
  "pip_requirements": {
    "enabled": false
  },
  "customManagers": [
    {
      "customType": "regex",
      "description": "Update `*_version` variables (case insensitive) in Ansible role variables files",
      "managerFilePatterns": [
        "/^\\.ansible/roles/[^/]+/vars/[^/]+\\.ya?ml$/",
        "/^\\.ansible/roles/[^/]+/defaults/[^/]+\\.ya?ml$/"
      ],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.+?) depName=(?<depName>.+?)(?: packageName=(?<packageName>.+?))?(?: versioning=(?<versioning>.+?))?(?: extractVersion=(?<extractVersion>.+?))?\\s+[a-zA-Z_][\\w]*?_(?i:version)\\s*:\\s+['\"]?(?<currentValue>.+?)['\"]?\\s"
      ]
    }
  ],
  "packageRules": [
    {
      "description": "Auto-merge non-major updates",
      "matchUpdateTypes": ["minor", "patch", "digest"],
      "automerge": true
    },
    {
      "description": "Configure Ansible dependencies globally",
      "matchFileNames": ["\\.ansible/**"],
      "semanticCommitScope": "ansible",
      "separateMajorMinor": false
    },
    {
      "description": "Configure Ansible helm dependencies",
      "matchFileNames": ["\\.ansible/**"],
      "matchPackageNames": ["/^helm/helm$/"],
      "commitMessageTopic": "helm",
      "groupName": "ansible-helm"
    },
    {
      "description": "Configure Ansible kind dependencies",
      "matchFileNames": ["\\.ansible/**"],
      "matchPackageNames": ["/^kubernetes-sigs/kind$/"],
      "commitMessageTopic": "kind",
      "groupName": "ansible-kind"
    },
    {
      "description": "Configure Ansible krew dependencies",
      "matchFileNames": ["\\.ansible/**"],
      "matchPackageNames": ["/^kubernetes-sigs/krew$/"],
      "commitMessageTopic": "krew",
      "groupName": "ansible-krew"
    },
    {
      "description": "Configure Ansible kubectl dependencies",
      "matchFileNames": ["\\.ansible/**"],
      "matchPackageNames": ["/^kubernetes/kubernetes$/"],
      "commitMessageTopic": "kubectl",
      "groupName": "ansible-kubectl"
    },
    {
      "description": "Configure Ansible kustomize dependencies",
      "matchFileNames": ["\\.ansible/**"],
      "matchPackageNames": ["/^kubernetes-sigs/kustomize$/"],
      "commitMessageTopic": "kustomize",
      "groupName": "ansible-kustomize"
    },
    {
      "description": "Configure Ansible nvm dependencies",
      "matchFileNames": ["\\.ansible/**"],
      "matchPackageNames": ["/^nvm-sh/nvm$/"],
      "commitMessageTopic": "nvm",
      "groupName": "ansible-nvm"
    }
  ]
}
